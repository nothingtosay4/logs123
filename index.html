<!DOCTYPE html>
<html>
<head>
    <title>VPN –¢—Ä–µ–∫–µ—Ä</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial; padding: 20px; }
        .log { border: 1px solid #ccc; padding: 10px; margin: 5px; }
        .ip { font-family: monospace; color: blue; }
        .vpn { background: red; color: white; padding: 2px 5px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background: #f2f2f2; }
    </style>
</head>
<body>
    <h1>üîç VPN –¢—Ä–µ–∫–µ—Ä</h1>
    
    <!-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Å—ã–ª–∫–∏ -->
    <div style="background: #f5f5f5; padding: 15px; margin: 20px 0;">
        <h3>–°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:</h3>
        <input type="text" id="ref" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞" value="test">
        <button onclick="generateLink()">–°–æ–∑–¥–∞—Ç—å</button>
        <br><br>
        <input type="text" id="link" style="width: 500px;" readonly>
        <button onclick="copyLink()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div style="margin: 20px 0;">
        <button onclick="loadLogs()" style="background: #4CAF50; color: white;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏</button>
        <button onclick="openSheet()" style="background: #2196F3; color: white;">üìä –û—Ç–∫—Ä—ã—Ç—å Google –¢–∞–±–ª–∏—Ü—É</button>
    </div>
    
    <!-- –õ–æ–≥–∏ -->
    <div id="logs">
        <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>
    
    <script>
        // URL –≤–∞—à–µ–≥–æ Google Apps Script
        const SCRIPT_URL = '–í–ê–®_GOOGLE_SCRIPT_URL'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
        function generateLink() {
            const ref = document.getElementById('ref').value || 'test';
            const url = `${window.location.origin}${window.location.pathname}track.html?ref=${ref}`;
            document.getElementById('link').value = url;
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
        function copyLink() {
            const link = document.getElementById('link');
            link.select();
            navigator.clipboard.writeText(link.value);
            alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤
        async function loadLogs() {
            try {
                document.getElementById('logs').innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
                
                const response = await fetch(`${SCRIPT_URL}?action=getLogs`);
                const logs = await response.json();
                
                if (logs.length === 0) {
                    document.getElementById('logs').innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
                    return;
                }
                
                let html = `<h3>–í—Å–µ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤: ${logs.length}</h3>`;
                html += '<table><tr><th>–í—Ä–µ–º—è</th><th>IP</th><th>–ú–µ—Ç–∫–∞</th><th>–ì–µ–æ</th><th>VPN</th><th>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th></tr>';
                
                logs.reverse().forEach(log => {
                    html += `
                        <tr>
                            <td>${log.time}</td>
                            <td><span class="ip">${log.ip}</span></td>
                            <td><strong>${log.ref}</strong></td>
                            <td>${log.country || ''} ${log.city || ''}</td>
                            <td>${log.vpn === '–î–∞' ? '<span class="vpn">VPN</span>' : '–ù–µ—Ç'}</td>
                            <td>${log.browser || ''}</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
                document.getElementById('logs').innerHTML = html;
            } catch (error) {
                document.getElementById('logs').innerHTML = `<p>–û—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        }
        
        // –û—Ç–∫—Ä—ã—Ç—å Google –¢–∞–±–ª–∏—Ü—É
        function openSheet() {
            window.open('https://docs.google.com/spreadsheets/d/–í–ê–®_–ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†', '_blank');
        }
        
        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞
        document.addEventListener('DOMContentLoaded', function() {
            generateLink();
            loadLogs();
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            setInterval(loadLogs, 10000);
        });
    </script>
</body>
</html>
